<html>

<head>

<body>
    <div><img id="background" src="https://sozai-good.com/download?id=2505&type=1&subnumber=0&extention=jpg"
            style="background-size: cover">
    </div>
    <p><img id="hato_picture" src="https://frame-illust.com/fi/wp-content/uploads/2017/03/9623.png" alt="はと"
            style="position:absolute; bottom:20px; width:50px; height:50px;">
    </p>
    <div><img id="enemy_1_ue"
            src="https://2.bp.blogspot.com/-6HhC2AY0eps/XLAdB1LYatI/AAAAAAABSU8/6mvfk-9iyAA0mK8q8IKI4tNqTFt0Y1IDgCLcBGAs/s800/fantsy_haneinu.png"
            alt="羽根犬" style="position:absolute; left:0px; top:125px; width:75px; height:75px; ">
    </div>
    <div><img id="enemy_2_ue"
            src="https://2.bp.blogspot.com/-6HhC2AY0eps/XLAdB1LYatI/AAAAAAABSU8/6mvfk-9iyAA0mK8q8IKI4tNqTFt0Y1IDgCLcBGAs/s800/fantsy_haneinu.png"
            alt="羽根犬" style="position:absolute; left:150px; top:125px; width:75px; height:75px;">
    </div>

    <div><img id="enemy_3_ue"
            src="https://2.bp.blogspot.com/-6HhC2AY0eps/XLAdB1LYatI/AAAAAAABSU8/6mvfk-9iyAA0mK8q8IKI4tNqTFt0Y1IDgCLcBGAs/s800/fantsy_haneinu.png"
            alt="羽根犬" style="position:absolute; left:300px; top:125px; width:75px; height:75px;">
    </div>

    <div><img id="enemy_1_sita"
            src=https://4.bp.blogspot.com/-_XsuxM7-ql4/W8hDiCFTFGI/AAAAAAABPdU/PIspyn4_N6M2g2YWwJhMscKQPiPbjVYfACLcBGAs/s800/animal_cat_kowai.png
            alt="猫" style="position:absolute; left:100px; top:225px; width:75px; height:75px;">
    </div>
    <div><img id="enemy_2_sita"
            src=https://4.bp.blogspot.com/-_XsuxM7-ql4/W8hDiCFTFGI/AAAAAAABPdU/PIspyn4_N6M2g2YWwJhMscKQPiPbjVYfACLcBGAs/s800/animal_cat_kowai.png
            alt="猫" style="position:absolute; left:250px; top:225px; width:75px; height:75px;">
    </div>
    <div id="dot" class="dot"
        style="position:absolute; bottom:70px; height:5px; width:5px;background-color:black;display:none;">
    </div>
    <div id="dot_enemy" class="dot_enemy"
        style="position:absolute; top:1px; height:5px; width:5px;background-color:black;display:none;">
    </div>
    <p id="start" style="position:absolute; bottom: 300px; left:1px; font-size:150px; color:greenyellow;display:none; ">
        Start!
    </p>
    <p id="nextStage" style="font-size:150px; position:absolute; top: 1px; right:1px; color:black;display:none; "> Next
        Stage!! </p>
    <p id="gameOver" style="font-size:150px; position:absolute; top: 1px; right:1px;  color:red ;display:none; ">
        Game Over!!!!
    </p>

    <script>
        //始まりの合図

        console.log(document.cookie);
        if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') { document.getElementById("background").src = 'http://xn--pckhn6qwa9bw091b5jnuo4dopq.biz/wp-content/uploads/2014/06/No.027.jpg' }
        if (document.cookie != 'stage=2&life=1' && document.cookie != 'stage=2&life=2' && document.cookie != 'stage=2&life=3' &&
            document.cookie != 'stage=1&life=1' && document.cookie != 'stage=1&life=2' && document.cookie != 'stage=1&life=3') { document.cookie = 'stage=1&life=3' }
        console.log(document.cookie);

        function startMove() {
            if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') { return }
            else {
                var start = document.getElementById("start");
                start.style.display = "block";
                var pos = parseInt(start.style.left);
                pos++;
                start.style.left = pos + "px";
            }
        }
        setInterval(function () {
            startMove()
        }, 1)

        function nextStageMove() {
            if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') {
                var nextStage = document.getElementById("nextStage");
                nextStage.style.display = "block";
                var pos = parseInt(nextStage.style.right);
                pos++;
                nextStage.style.right = pos + "px";
            }
        }

        function gameOverMove() {
            var gameOver = document.getElementById("gameOver");
            gameOver.style.display = "block";
            var pos = parseInt(gameOver.style.top);
            pos++;
            if (pos > window.innerHeight / 2) { pos = 0 };
            gameOver.style.top = pos + "px";

        }

        //ウィンドウサイズ割る２の関数
        function middleInWindow() {
            var winsize = (window.innerWidth) / 2;
            return parseInt(winsize);
        }

        //ハトがウィンドウのサイズに合わせて初期位置を得とく 
        function resetHatoPosition() {
            var hato_picture = document.getElementById("hato_picture"); hato_picture.style.left = (middleInWindow() - 25 + "px");
        }

        //上の敵が動く為の関数
        function moveEnemy(enemy) {
            if (enemy == null) return;
            var posTop = parseInt(enemy.style.top);
            var pos = parseInt(enemy.style.left);
            if (posTop < 150) {
                if (pos >= window.innerWidth) {
                    pos = 0;
                } else {
                    pos++;
                }
                enemy.style.left = pos + "px";
            }
            if (posTop > 150) {
                if (pos <= -75) { pos = window.innerWidth; }
                else { pos--; }
                enemy.style.left = pos + "px";
            }
        }

        // 上の配列を動かす
        var enemy1 = document.getElementById("enemy_1_ue");
        var enemy2 = document.getElementById("enemy_2_ue");
        var enemy3 = document.getElementById("enemy_3_ue");
        var enemy4 = document.getElementById("enemy_1_sita");
        var enemy5 = document.getElementById("enemy_2_sita");
        var Enemies = [enemy1, enemy2, enemy3, enemy4, enemy5];
        if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') {
            Enemies.forEach(enemy => {
                setInterval(function () {
                    moveEnemy(enemy)
                }, 1)
            })
        } else {
            Enemies.forEach(enemy => {
                setInterval(function () {
                    moveEnemy(enemy)
                }, 10)
            })
        }

        //上の敵が弾を撃つための関数
        function enemy_shoot(enemy, dot) {
            if (document.getElementById(enemy.id) == null) return;
            var dot_tpl = document.getElementById("dot_enemy");
            var dot = dot_tpl.cloneNode(false);
            dot.style.display = "block";
            dot.style.left = parseInt(enemy.style.left) + parseInt(enemy.style.width) / 2 + "px";
            enemy.style.bottom = parseInt(enemy.style.top) + parseInt(enemy.style.height);
            document.body.appendChild(dot);
            var pos = parseInt(enemy.style.bottom);
            var timer_id = null;
            function frame() {
                if (pos >= window.innerHeight) {
                    clearInterval(timer_id);
                    dot.remove();
                } else {
                    pos++;
                    dot.style.top = pos + "px";
                    hato_hit(enemy, dot);
                }
                var hit = hato_hit(enemy, dot);
                if (hit) {
                    clearInterval(timer_id);
                }
            }
            if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') { timer_id = setInterval(frame, 1) }
            else { timer_id = setInterval(frame, 10); }
        }
        if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') {
            Enemies.forEach(enemy => {
                setInterval(
                    () =>
                        enemy_shoot(enemy)
                    , 1000)
            })
        } else {
            Enemies.forEach(enemy => {
                setInterval(
                    () =>
                        enemy_shoot(enemy)
                    , 3000)
            })
        }
        if (document.cookie == "stage=1&life=3") { var life = 6 };
        if (document.cookie == "stage=2&life=3") { var life = 6 };
        if (document.cookie == "stage=2&life=2") {
            var life = 4;
            document.getElementById("hato_picture").src = 'http://oide43.com/wp-content/uploads/2015/10/pigeon_side-handwrittenstyle.png';
        };
        if (document.cookie == "stage=2&life=1") {
            var life = 2;
            document.getElementById("hato_picture").src = 'https://hairastro.info/wp-content/uploads/2018/04/halanshandeshiA.jpg';
        };
        function hato_hit(enemy, dot) {
            var hato = document.getElementById("hato_picture");
            if (hato == null) return;
            var bullet = parseInt(dot.style.top);
            var bulletLeft = parseInt(dot.style.left);
            var hatoTop = window.innerHeight - ((hato.clientHeight) + 20);
            var hatoBottom = window.innerHeight - 20;
            var hatoLeft = parseInt(hato.style.left);
            var hatoRight = hatoLeft + hato.clientWidth;
            if ((bullet >= hatoTop) && (bullet <= hatoBottom) && (bulletLeft >= hatoLeft) && (bulletLeft <= hatoRight)) {
                console.log("Autsch!");
                console.log(life);
                dot.remove();
                life--;
                if (life == 4) {
                    str = document.cookie;
                    arr = str.split("&");
                    key_value = arr[1].split("=");
                    key_value[1] = "2";
                    key_value.join("=");
                    arr[1] = key_value.join("=");
                    arr.join("&");
                    str = arr.join("&");
                    document.cookie = str;
                    document.getElementById("hato_picture").src = 'http://oide43.com/wp-content/uploads/2015/10/pigeon_side-handwrittenstyle.png';
                } if (life == 2) {
                    str = document.cookie;
                    arr = str.split("&");
                    key_value = arr[1].split("=");
                    key_value[1] = "1";
                    key_value.join("=");
                    arr[1] = key_value.join("=");
                    arr.join("&");
                    str = arr.join("&");
                    document.cookie = str;
                    document.getElementById("hato_picture").src = 'https://hairastro.info/wp-content/uploads/2018/04/halanshandeshiA.jpg';
                } if (life == 0) {
                    document.getElementById("hato_picture").src = 'http://gahag.net/img/201604/17s/gahag-0076883272-1.png';
                    setInterval(function () { hato.remove() }, 300);
                    setInterval(function () { gameOverMove() }, 500);
                    setTimeout(function () { window.confirm("Continue?") }, 1500);
                    setTimeout(function () { location.reload() }, 1700);
                    setTimeout(function () { document.cookie = 'stage=1&life=3' }, 2000);
                }
                return true;
            } else { return false; }
        }

        function next_stage() {
            var enemy1 = document.getElementById("enemy_1_ue");
            var enemy2 = document.getElementById("enemy_2_ue");
            var enemy3 = document.getElementById("enemy_3_ue");
            var enemy4 = document.getElementById("enemy_1_sita");
            var enemy5 = document.getElementById("enemy_2_sita");
            var Enemies = [enemy1, enemy2, enemy3, enemy4, enemy5];
            if (Enemies.filter(n => n).length <= 0) {
                if (document.cookie == 'stage=2&life=1' || document.cookie == 'stage=2&life=2' || document.cookie == 'stage=2&life=3') {
                    setTimeout(function () { document.getElementById("background").src = 'http://dreamaker.jp/img/materials/20140102201313_5a7dfeba.png'; }, 100);
                    setTimeout(function () { window.confirm("Congratulation!!How about one more round?") }, 400);
                    setTimeout(function () { document.cookie = 'stage=2; max-age=0'; }, 450);
                    setTimeout(function () { location.reload(); }, 500);
                } else {
                    str = document.cookie;
                    arr = str.split("&");
                    key_value = arr[0].split("=");
                    key_value[1] = "2";
                    key_value.join("=");
                    arr[0] = key_value.join("=");
                    arr.join("&");
                    str = arr.join("&");
                    document.cookie = str;
                    console.log(document.cookie);
                    setInterval(function () { nextStageMove() }, 1);
                    setTimeout(function () { location.reload(); }, 500);
                }
            }
        }

        // 上の敵に弾が当たった時に弾と敵が消える
        function enemy_vanish(enemy, dot) {
            if (enemy == null) return;
            var bullet = parseInt(dot.style.bottom);
            var bulletLeft = parseInt(dot.style.left);
            const enemyTop = window.innerHeight - parseInt(enemy.style.top);
            const enemyLeft = parseInt(enemy.style.left);
            const enemyBottom = enemyTop - parseInt(enemy.style.height);
            const enemyRight = enemyLeft + enemy.clientWidth;
            if ((bullet >= enemyBottom) && (bullet <= enemyTop) && (bulletLeft >= enemyLeft) && (bulletLeft <= enemyRight)) {
                dot.remove();
                enemy.remove();
                console.log("hit");
                next_stage();
                return true;
            } else {
                enemy.style.borderColor = "black";
                return false;
            }
        }

        //弾を射つ為の関数
        function hatoShoot() {
            var dot_tpl = document.getElementById("dot");
            var dot = dot_tpl.cloneNode(false); dot.style.display = "block";
            hato_picture = document.getElementById("hato_picture");
            hato_picture_left = hato_picture.style.left;
            var hato_picture_right = window.innerWidth - hato_picture_left;
            dot.style.left = parseInt(hato_picture_left) + parseInt(hato_picture.style.width) / 2 + "px";
            document.body.appendChild(dot);
            var pos = 70;
            var timer_id = setInterval(frame, 1);
            function frame() {
                if (pos >=
                    window.innerHeight) {
                    clearInterval(timer_id);
                    dot.remove();
                } else {
                    pos++;
                    dot.style.bottom = pos + "px";
                }
                Enemies.forEach(enemy => {
                    const hit = enemy_vanish(enemy, dot);
                    if (hit) {
                        clearInterval(timer_id);
                    }
                })
            }
        }

        resetHatoPosition();
        //キーボード総裁のイベント
        document.onkeydown = function (e) {
            var keyCode = false;
            if (e) event = e;
            if (event) {
                if (event.keyCode) {
                    keyCode = event.keyCode;
                } else if (event.which) {
                    keyCode = event.which;
                }
            }
            //操作の為のキーボードコード
            var hato_picture = document.getElementById("hato_picture");
            if (hato_picture == null) { return };
            if (keyCode == 72) {
                if (parseInt(hato_picture.style.left) > 0)
                    moveLeft();
            } else if (keyCode == 76) {
                if (parseInt(hato_picture.style.left) < parseInt(window.innerWidth) - 25) moveRight();
            } else if
                (keyCode == 32) { hatoShoot(); }
        }; //左へ動く
        var moveLeft = function () {
            var hato = document.getElementById("hato_picture"); var hatoLeft = parseInt(hato.style.left);
            hato.style.left = (hatoLeft - 50 + "px"); if (parseInt(hato.style.left) < 50) {
                hato.style.left = "0" + "px";
            }
        };
        //右へ動く
        var moveRight = function () {
            var hato_picture = document.getElementById("hato_picture");
            var current_left = parseInt(hato_picture.style.left); hato_picture.style.left = (current_left + 50 + "px");
            if (parseInt(hato_picture.style.left) > parseInt(window.innerWidth) - 50) {
                hato_picture.style.left = window.innerWidth - 50;
            } //右端への距離が５０px以下の時、強制的にストップ
        };

    </script>
</body>

</html>